name: Custom Action Workflow

on:
  workflow_dispatch:
    inputs:
      who-to-greet:
        description: 'Who to greet'
        required: true
        default: 'World'

jobs:
  custom_action_job:
    runs-on: self-hosted
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Run Custom Action
        uses: ./  
        
      - name: Set up Docker and Execute Custom Action
        run: |
          docker run -d -v $(pwd):/workspace alpine:latest sh -c "\
            mkdir -p /workspace && \
            cp /github/workspace/entrypoint.sh /workspace/entrypoint.sh && \
            chmod +x /workspace/entrypoint.sh && \
            /workspace/entrypoint.sh ${{ github.event.inputs.who-to-greet }}"

      - name: Clean up Docker container
        run: docker rm -f $(docker ps -lq)
