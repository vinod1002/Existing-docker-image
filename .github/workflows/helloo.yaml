name: Custom Action Workflow

on:
  workflow_dispatch:
    inputs:
      who-to-greet:
        description: 'Who to greet'
        required: true
        default: 'World'

jobs:
  custom_action_job:
    runs-on: self-hosted
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        
      - name: Stop and remove Docker containers
        run: |
          docker stop my-container || true  
          docker rm -f my-container || true 
          docker stop my-container-1 || true  
          docker rm -f my-container-1 || true 

      - name: Set up Docker
        run: |
          docker run -d --name my-container -v $(pwd):/workspace alpine:latest tail -f /dev/null

      - name: Copy entrypoint.sh to Docker container
        run: |
          ls -l  # Debugging: List files in current directory
          ls -l /workspace  # Debugging: List files in /workspace inside the Docker container
          docker cp entrypoint.sh my-container:/workspace/entrypoint.sh
          docker exec my-container chmod +x /workspace/entrypoint.sh

      - name: Execute Custom Docker Action
        uses: ./
        with:
          who-to-greet: ${{ github.event.inputs.who-to-greet }}

      - name: Clean up Docker container
        run: docker rm -f my-container
